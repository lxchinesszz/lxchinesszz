import{_ as i,o as a,c as n,a4 as l}from"./chunks/framework.B8fosacB.js";const g=JSON.parse('{"title":"Elastic-Jobæºç è§£æ(ä¸‰)ä¹‹åˆ†ç‰‡å®šæ—¶ä»»åŠ¡æ‰§è¡Œ","description":"","frontmatter":{"breadcrumb":false,"navbar":true,"sidebar":true,"pageInfo":true,"contributor":true,"editLink":true,"updateTime":true,"prev":true,"next":true,"comment":true,"footer":true,"backtotop":true,"title":"Elastic-Jobæºç è§£æ(ä¸‰)ä¹‹åˆ†ç‰‡å®šæ—¶ä»»åŠ¡æ‰§è¡Œ","category":"Elastic-Job"},"headers":[],"relativePath":"post/java/jobs/Elastic-Jobæºç è§£æ(ä¸‰)ä¹‹åˆ†ç‰‡å®šæ—¶ä»»åŠ¡æ‰§è¡Œ.md","filePath":"post/java/jobs/Elastic-Jobæºç è§£æ(ä¸‰)ä¹‹åˆ†ç‰‡å®šæ—¶ä»»åŠ¡æ‰§è¡Œ.md","lastUpdated":1731158524000}'),p={name:"post/java/jobs/Elastic-Jobæºç è§£æ(ä¸‰)ä¹‹åˆ†ç‰‡å®šæ—¶ä»»åŠ¡æ‰§è¡Œ.md"};function e(h,s,t,k,r,E){return a(),n("div",{"data-pagefind-body":!0},s[0]||(s[0]=[l(`<blockquote><p>é€šè¿‡æœ¬ç¯‡çš„é˜…è¯»ä½ å°†å­¦ä¼šäº†è§£Elastic-Jobçš„å®šæ—¶æ—¶æœº,åŠå¦‚ä½•é€šè¿‡åˆ†ç‰‡æ–¹å¼åšä¸€ä¸ªåˆ†å¸ƒå¼çš„å®šæ—¶ä»»åŠ¡æ¡†æ¶ã€‚äº†è§£å¸¸ç”¨çš„ä¸‰ç§åˆ†ç‰‡ç­–ç•¥ï¼ŒåŠå¦‚ä½•è‡ªå®šä¹‰åˆ†å¸ƒå¼åˆ†ç‰‡ç­–ç•¥</p></blockquote><h2 id="elastic-jobå¦‚ä½•é€šè¿‡springjobschedulerå¯åŠ¨å®šæ—¶" tabindex="-1">Elastic-Jobå¦‚ä½•é€šè¿‡SpringJobSchedulerå¯åŠ¨å®šæ—¶ <a class="header-anchor" href="#elastic-jobå¦‚ä½•é€šè¿‡springjobschedulerå¯åŠ¨å®šæ—¶" aria-label="Permalink to &quot;Elastic-Jobå¦‚ä½•é€šè¿‡SpringJobSchedulerå¯åŠ¨å®šæ—¶&quot;">â€‹</a></h2><p>åœ¨&lt;&lt;Elastic-Jobæºç è§£æï¼ˆä¸€ï¼‰ä¹‹ä¸Springå®Œç¾æ•´åˆ&gt;&gt;ä¸­æˆ‘ä»¬å·²ç»äº†è§£Elasti-Jobéå¸¸å·§å¦™çš„ç”¨BeanDefinitionParseè§£æå™¨å°†ä»»åŠ¡ç±»å‹æœ€ç»ˆé€šè¿‡æŠ½è±¡ç±»çš„æ–¹å¼è§£ææˆäº†SpringJobScheduler</p><p><img src="https://img.springlearn.cn/blog/7f001280f2350642dd2e9b1a9ebfbf46.png" alt=""></p><ul><li>SpringJobScheduler</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> abstract</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbstractJobBeanDefinitionParser</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> extends</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AbstractBeanDefinitionParser</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Override</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractBeanDefinition </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">parseInternal</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Element </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">element</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ParserContext </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">parserContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        BeanDefinitionBuilder factory </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BeanDefinitionBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rootBeanDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(SpringJobScheduler.class);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">setInitMethodName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        //TODO æŠ½è±¡å­ç±»</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JOB_REF_ATTRIBUTE))) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">equals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CLASS_ATTRIBUTE))) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(BeanDefinitionBuilder.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">rootBeanDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(CLASS_ATTRIBUTE)).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBeanDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(JOB_REF_ATTRIBUTE));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgReference</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getAttribute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(REGISTRY_CENTER_REF_ATTRIBUTE));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createLiteJobConfiguration</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(parserContext, element));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        BeanDefinition jobEventConfig </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createJobEventConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> !=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> jobEventConfig) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobEventConfig);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">addConstructorArgValue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createJobListeners</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(element));</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> factory.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getBeanDefinition</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>é€šè¿‡æŠ½è±¡ç±»çš„æ–¹å¼è§£ææˆäº†SpringJobScheduler æˆ‘ä»¬çœ‹SpringJobSchedulerå®šæ—¶å™¨çš„æ¶æ„,SpringJobSchedulerå°±æ˜¯ä¸€ä¸ªå®šæ—¶å™¨,æ˜¯JobSchedulerçš„å­ç±»ã€‚çœŸæ­£å®šæ—¶çš„é€»è¾‘æ˜¯ç”±JobSchedulerç±»å¤„ç†çš„åŒ…æ‹¬ä¸Šé¢çš„initæ–¹æ³•å’Œshutdownæ–¹æ³•ã€‚</p><p><img src="https://img.springlearn.cn/blog/42691e6cc0c516599e3d809cab770d1e.png" alt=""></p><ul><li><p>initæ–¹æ³•ä¸­å¯åŠ¨å®šæ—¶å™¨,å¯ä»¥çœ‹åˆ°å†…éƒ¨æ ¸å¿ƒè¿˜æ˜¯ç”±quartzæ¥å®ç°çš„å’Œå°ç¼–åœ¨ä¸Šä¸€ç¯‡å†™çš„quartzå¾ˆç±»ä¼¼</p><p><img src="https://img.springlearn.cn/blog/e875c92491af1fee146358a70d55c673.png" alt=""></p></li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> scheduleJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String cron) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scheduler.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">checkExists</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobDetail.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getKey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">())) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                scheduler.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">scheduleJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobDetail, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">createTrigger</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(cron));</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            scheduler.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SchedulerException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JobSystemException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ex);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>ç„¶åæ ¹æ®ä»»åŠ¡ç±»å‹ç”ŸæˆæŒ‡å®šç±»å‹çš„æ‰§è¡Œå™¨,å¹¶æ‰§è¡Œ</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">@</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">NoArgsConstructor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">access</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AccessLevel.PRIVATE)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JobExecutorFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è·å–ä½œä¸šæ‰§è¡Œå™¨.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     *</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> elasticJob</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> åˆ†å¸ƒå¼å¼¹æ€§ä½œä¸š</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> jobFacade</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> ä½œä¸šå†…éƒ¨æœåŠ¡é—¨é¢æœåŠ¡</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> ä½œä¸šæ‰§è¡Œå™¨</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SuppressWarnings</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;unchecked&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> AbstractElasticJobExecutor </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getJobExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ElasticJob </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">elasticJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JobFacade </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jobFacade</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">null</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> elasticJob) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ScriptJobExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobFacade);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (elasticJob </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> SimpleJob) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SimpleJobExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((SimpleJob) elasticJob, jobFacade);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (elasticJob </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">instanceof</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> DataflowJob) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> DataflowJobExecutor</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">((DataflowJob) elasticJob, jobFacade);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JobConfigurationException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Cannot support job type &#39;%s&#39;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, elasticJob.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getClass</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getCanonicalName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><p>ä»»åŠ¡ç±»å‹å¯¹åº”çš„æ‰§è¡Œå™¨æ˜¯ä¸‹é¢è¿™äº›</p><p><img src="https://img.springlearn.cn/blog/a0d048b046f999ee5516dfea48d6f7d6.png" alt=""></p><p>ä»ä¸­æˆ‘ä»¬åˆ†ææœ€å¸¸è§çš„ä»»åŠ¡ç±»å‹SimpleJobExecutorï¼Œè¿™é‡Œé¢æˆ‘ä»¬ä¸»è¦çœ‹ShardingContextåˆ†ç‰‡ä¸Šä¸‹æ–‡æ˜¯æ€ä¹ˆç”Ÿæˆçš„ï¼Œå¾ˆæ˜æ˜¾æ˜¯æœ‰æŠ½è±¡ç±»AbstractElasticJobExecutoræ¥ç”Ÿæˆçš„ã€‚åˆ†ç‰‡ç­–ç•¥ä¸€å®šä¹Ÿæ˜¯åœ¨è¿™ä¸ªé‡Œé¢æ‰§è¡Œçš„ï¼Œæœ€ç»ˆç”ŸæˆShardingContextç±»çš„ï¼Œè€Œè¿™ä¸ªç±»å°±æ˜¯Elastic-Jobç»™æ¯å°æœåŠ¡å™¨ä¸Šçš„ä»»åŠ¡åˆ†é…çš„ä¸Šä¸‹æ–‡,è¿™é‡Œé¢å°±åŒ…æ‹¬äº†åˆ†é…æ ‡è¯†</p><p><img src="https://img.springlearn.cn/blog/0e9939fffeb0a11e4bbe85dbf5761f8f.png" alt=""></p><h2 id="åˆ†ç‰‡ç­–ç•¥å¦‚ä½•ä½¿ç”¨" tabindex="-1">åˆ†ç‰‡ç­–ç•¥å¦‚ä½•ä½¿ç”¨ <a class="header-anchor" href="#åˆ†ç‰‡ç­–ç•¥å¦‚ä½•ä½¿ç”¨" aria-label="Permalink to &quot;åˆ†ç‰‡ç­–ç•¥å¦‚ä½•ä½¿ç”¨&quot;">â€‹</a></h2><p>ç»™åˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„æ¯ä¸ªä»»åŠ¡å®ä¾‹, ä¸€ä¸ªç‰¹å®šçš„åˆ†ç‰‡æ ‡è®°ã€‚ç„¶åæ¯ä¸ªä»»åŠ¡å®ä¾‹ä¸­æ ¹æ®åˆ†ç‰‡æ ‡è®°å»è·å–æ•°æ®ã€‚ä»¥æ­¤æ¥é¿å…ä»»åŠ¡é‡å¤æ‰§è¡Œã€‚é‚£ä¹ˆç©¶ç«Ÿæ˜¯å¦‚ä½•é¿å…å‘¢? å…¶å®è¿˜æ˜¯å¼€å‘è€…è‡ªå·±æ¥é¿å…çš„, jobåªä¿è¯åŒä¸€ä¸ªåˆ†ç‰‡åªä¼šåˆ†åˆ°ä¸€ä¸ªå®ä¾‹ä¸Šï¼Œä¸ä¼šåˆ†é…åˆ°ä¸¤ä¸ªå®ä¾‹ä¸Šã€‚</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> InvokerTimer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> implements</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> SimpleJob</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    @</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    private</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Core core;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> void</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> execute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(ShardingContext </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">shardingContext</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">){</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // è·å–åˆ†ç‰‡ä¿¡æ¯</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> item </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> shardingContext.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getShardingItem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // æ ¹æ®åˆ†ç‰‡ä¿¡æ¯,è·å–è¿™å°å®ä¾‹ä¸Šåº”è¯¥å¤„ç†çš„æ•°æ®</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        List&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">String</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; orgIds </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> core.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">queryOrgIdsByScheduleZone</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(item);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h2 id="elastic-jobçš„ä¸‰ç§åˆ†ç‰‡ç­–ç•¥" tabindex="-1">Elastic-Jobçš„ä¸‰ç§åˆ†ç‰‡ç­–ç•¥ <a class="header-anchor" href="#elastic-jobçš„ä¸‰ç§åˆ†ç‰‡ç­–ç•¥" aria-label="Permalink to &quot;Elastic-Jobçš„ä¸‰ç§åˆ†ç‰‡ç­–ç•¥&quot;">â€‹</a></h2><p>ä»€ä¹ˆæ˜¯åˆ†ç‰‡ç­–ç•¥å‘¢? ä»€ä¹ˆæƒ…å†µä¸‹æœ‰åˆ†ç‰‡ç­–ç•¥å‘¢? å…¶å®è¿™å°±æ˜¯Elastic Job ä½œä¸ºåˆ†å¸ƒå¼ä»»åŠ¡çš„äº®ç‚¹ã€‚å°±æ˜¯é€šè¿‡åˆ†ç‰‡çš„ç­–ç•¥ï¼Œæ¥ç»™æ¯å°å®ä¾‹æŒ‡å®šæ•°æ®ï¼Œé˜²æ­¢å¤šå°å®ä¾‹é‡å¤å¤„ç†æ•°æ®ã€‚ ElasticJob æ˜¯é€šè¿‡Zookeeperæ¥è¿›è¡Œäº¤äº’å’Œåˆ†é…ä»»åŠ¡ï¼Œè¿™é‡Œè¯´åˆ†é…ä»»åŠ¡æœ‰ç‚¹å¤¸å¤§äº†ä»–çš„èƒ½åŠ›ï¼Œä»–å…¶å®åªæ˜¯ç»™ä½ ä¸ªåˆ†ç‰‡ï¼Œç„¶åå¼€å‘è€…æ ¹æ®åˆ†ç‰‡å»è‡ªå·±åˆ°æ•°æ®åº“æˆ–è€…æ˜¯å…¶ä»–æ•°æ®æºä¸­æ‹¿åˆ°ï¼Œæ”¹åˆ†ç‰‡å¯¹åº”çš„ ä»»åŠ¡æ¥æ‰§è¡Œã€‚è€Œæˆ‘ä»¬æ‰€è°“è¯´çš„åˆ†ç‰‡å°±æ˜¯ShardingContextå¯¹è±¡ã€‚å°±æ˜¯è¯´ElasticJobæŠŠä½ ç”Ÿæˆäº†ShardingContextã€‚ElasticJobæä¾›äº†3ä¸­ç­–ç•¥ã€‚</p><p><img src="https://img.springlearn.cn/blog/a7395e57fec4434fa4ec95b9675733b4.png" alt=""></p><h3 id="å¹³å‡åˆ†ç‰‡" tabindex="-1">å¹³å‡åˆ†ç‰‡ <a class="header-anchor" href="#å¹³å‡åˆ†ç‰‡" aria-label="Permalink to &quot;å¹³å‡åˆ†ç‰‡&quot;">â€‹</a></h3><p>AverageAllocationJobShardingStrategy å¹³å‡åˆ†ç‰‡</p><p>å¦‚æœåˆ†ç‰‡ä¸èƒ½æ•´é™¤, åˆ™ä¸èƒ½æ•´é™¤çš„å¤šä½™åˆ†ç‰‡å°†ä¾æ¬¡è¿½åŠ åˆ°åºå·å°çš„æœåŠ¡å™¨.</p><p>å¦‚:</p><p>å¦‚æœæœ‰3å°æœåŠ¡å™¨, åˆ†æˆ9ç‰‡, åˆ™æ¯å°æœåŠ¡å™¨åˆ†åˆ°çš„åˆ†ç‰‡æ˜¯: 1=[0,1,2], 2=[3,4,5], 3=[6,7,8]. å¦‚æœæœ‰3å°æœåŠ¡å™¨, åˆ†æˆ8ç‰‡, åˆ™æ¯å°æœåŠ¡å™¨åˆ†åˆ°çš„åˆ†ç‰‡æ˜¯: 1=[0,1,6], 2=[2,3,7], 3=[4,5]. å¦‚æœæœ‰3å°æœåŠ¡å™¨, åˆ†æˆ10ç‰‡, åˆ™æ¯å°æœåŠ¡å™¨åˆ†åˆ°çš„åˆ†ç‰‡æ˜¯: 1=[0,1,2,9], 2=[3,4,5], 3=[6,7,8].</p><p><img src="https://img.springlearn.cn/blog/255465d3eb11f645df51d02e2410c243.png" alt=""></p><h3 id="hash-åˆ†ç‰‡" tabindex="-1">hash åˆ†ç‰‡ <a class="header-anchor" href="#hash-åˆ†ç‰‡" aria-label="Permalink to &quot;hash åˆ†ç‰‡&quot;">â€‹</a></h3><p>æ ¹æ®ä½œä¸šåçš„å“ˆå¸Œå€¼å¥‡å¶æ•°å†³å®šIPå‡é™åºç®—æ³•çš„åˆ†ç‰‡ç­–ç•¥.</p><ul><li>ä½œä¸šåçš„å“ˆå¸Œå€¼ä¸ºå¥‡æ•°åˆ™IPå‡åº.</li><li>ä½œä¸šåçš„å“ˆå¸Œå€¼ä¸ºå¶æ•°åˆ™IPé™åº. ç”¨äºä¸åŒçš„ä½œä¸šå¹³å‡åˆ†é…è´Ÿè½½è‡³ä¸åŒçš„æœåŠ¡å™¨.</li></ul><p>å¦‚:</p><ol><li>å¦‚æœæœ‰3å°æœåŠ¡å™¨, åˆ†æˆ2ç‰‡, ä½œä¸šåç§°çš„å“ˆå¸Œå€¼ä¸ºå¥‡æ•°, åˆ™æ¯å°æœåŠ¡å™¨åˆ†åˆ°çš„åˆ†ç‰‡æ˜¯: 1=[0], 2=[1], 3=[].</li><li>å¦‚æœæœ‰3å°æœåŠ¡å™¨, åˆ†æˆ2ç‰‡, ä½œä¸šåç§°çš„å“ˆå¸Œå€¼ä¸ºå¶æ•°, åˆ™æ¯å°æœåŠ¡å™¨åˆ†åˆ°çš„åˆ†ç‰‡æ˜¯: 3=[0], 2=[1], 1=[].</li></ol><p><img src="https://img.springlearn.cn/blog/ecb79278e6946fc1a601ea26c22d0877.png" alt=""></p><h3 id="è½®è®­åˆ†ç‰‡" tabindex="-1">è½®è®­åˆ†ç‰‡ <a class="header-anchor" href="#è½®è®­åˆ†ç‰‡" aria-label="Permalink to &quot;è½®è®­åˆ†ç‰‡&quot;">â€‹</a></h3><p><img src="https://img.springlearn.cn/blog/35ace4831dd6794a3365d5a95889eace.png" alt=""></p><h2 id="åˆ†ç‰‡ç­–ç•¥æ€»ç»“" tabindex="-1">åˆ†ç‰‡ç­–ç•¥æ€»ç»“ <a class="header-anchor" href="#åˆ†ç‰‡ç­–ç•¥æ€»ç»“" aria-label="Permalink to &quot;åˆ†ç‰‡ç­–ç•¥æ€»ç»“&quot;">â€‹</a></h2><p>é€šè¿‡å¯¹ä¸Šé¢çš„åˆ†ç‰‡ç­–ç•¥æ¥çœ‹å•Šï¼Œè¿™æ‰€è°“çš„ä¸‰ç§åˆ†ç‰‡ç­–ç•¥å…¶å®éƒ½æ˜¯åˆ©ç”¨AverageAllocationJobShardingStrategy å¹³å‡åˆ†ç‰‡ï¼Œ<code>éå¸¸å·§å¦™ä¹Ÿéå¸¸æ•·è¡ğŸ˜‚</code>ã€‚ å·§å¦™æ˜¯è¯´å……åˆ†åˆ©ç”¨äº†å¹³å‡åˆ†ç‰‡çš„ç­–ç•¥ï¼Œåªä¸è¿‡å°†serverListæ’åºå°±å®ç°äº†å¦ä¸€ç§åˆ†ç‰‡ç­–ç•¥ï¼Œæ•·è¡æ˜¯è¯´æ²¡æœ‰å¤šå¤§ä½œç”¨ã€‚å…¶å®å®Œå…¨å¯ä»¥å®ç°é€šè¿‡æœºå™¨æ€§èƒ½çš„ç›‘æ§åŒæ­¥åˆ°ZK,ç„¶ååœ¨æ ¹æ®æœºå™¨æ€§èƒ½æ¥å¹³å‡åˆ†ç‰‡çš„ï¼Œè¿™æ ·å°ç¼–æ„Ÿè§‰æ›´åŠ åˆç†å†™ã€‚ä¸è¿‡å› ä¸ºElastic Jobæä¾›äº†æŒ‡å®šç­–ç•¥çš„æ¥å£ï¼Œæ‰€ä»¥å…·ä½“æ€ä¹ˆåˆ†çš„èƒ½åŠ›ï¼Œå°±äº¤ç»™ä½¿ç”¨è€…è‡ªå·±å»å®ç°å§ã€‚ å¯¹äºæ ¹æ®ä½œä¸šåè½®è¯¢ç­–ç•¥å’ŒIPé™çº§ç­–ç•¥ï¼Œå°ç¼–æ— è¯å¯è¯´ï¼Œä¸çŸ¥é“åˆ°åº•å¥½ç”¨ä¸å¥½ç”¨ï¼Œä»¥åŠæœ‰å•¥å®é™…ç”¨å¤„ã€‚ä¸è¿‡å°ç¼–åœ¨å·¥ä½œä¸­ä¸€ç›´ç”¨å¹³å‡ç­–ç•¥ã€‚è¯´åˆ°è¿™é‡Œæˆ‘ä»¬é¡ºä¾¿åˆ†æä¸‹å¦‚ä½•è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥ã€‚</p><h2 id="å¦‚ä½•è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥" tabindex="-1">å¦‚ä½•è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥ <a class="header-anchor" href="#å¦‚ä½•è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥" aria-label="Permalink to &quot;å¦‚ä½•è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥&quot;">â€‹</a></h2><p>æˆ‘ä»¬å…ˆçœ‹æºç æ˜¯ä»å“ªé‡Œå¼„åˆ°åˆ†ç‰‡ç­–ç•¥ä¿¡æ¯çš„</p><p><img src="https://img.springlearn.cn/blog/99436a94e51cf77981d3be3fd16f688c.png" alt=""> ä»é…ç½®ä¸­è¯»å–åˆ†ç‰‡ç­–ç•¥classå±æ€§å€¼ <img src="https://img.springlearn.cn/blog/a763c56d2152e8da15019d05b97e798f.png" alt=""></p><p>è‡ªå®šä¹‰åˆ†ç‰‡ç­–ç•¥class å¦‚æœæ²¡æœ‰æŒ‡å®šé»˜è®¤å¹³å‡åˆ†ï¼Œåœ¨JobShardingStrategyFactoryä¸­æŒ‡å®šé»˜è®¤</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> final</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JobShardingStrategyFactory</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    /**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * è·å–ä½œä¸šåˆ†ç‰‡ç­–ç•¥å®ä¾‹.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"> jobShardingStrategyClassName</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> ä½œä¸šåˆ†ç‰‡ç­–ç•¥ç±»å</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@return</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> ä½œä¸šåˆ†ç‰‡ç­–ç•¥å®ä¾‹</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> static</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> JobShardingStrategy </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> String </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">jobShardingStrategyClassName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (Strings.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isNullOrEmpty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobShardingStrategyClassName)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> AverageAllocationJobShardingStrategy</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            Class&lt;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; jobShardingStrategyClass </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Class.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">forName</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobShardingStrategyClassName);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">JobShardingStrategy.class.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">isAssignableFrom</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(jobShardingStrategyClass)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">                throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JobConfigurationException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Class &#39;%s&#39; is not job strategy class&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, jobShardingStrategyClassName);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            }</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (JobShardingStrategy) jobShardingStrategyClass.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">newInstance</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">final</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ClassNotFoundException | InstantiationException | IllegalAccessException </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            throw</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> JobConfigurationException</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Sharding strategy class &#39;%s&#39; config error, message details are &#39;%s&#39;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, jobShardingStrategyClassName, ex.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">getMessage</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">());</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div>`,43)]))}const c=i(p,[["render",e]]);export{g as __pageData,c as default};
