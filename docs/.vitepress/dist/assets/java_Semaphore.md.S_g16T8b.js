import{_ as i,c as a,aa as n,o as e}from"./chunks/framework.CC62xl_U.js";const E=JSON.parse('{"title":"ä¿¡å·é‡ Semaphore","description":"","frontmatter":{"breadcrumb":false,"navbar":true,"sidebar":true,"pageInfo":true,"contributor":true,"editLink":true,"updateTime":true,"prev":true,"next":true,"comment":false,"footer":true,"backtotop":true,"title":"ä¿¡å·é‡ Semaphore","category":"Javaè¿›é˜¶"},"headers":[],"relativePath":"java/Semaphore.md","filePath":"java/Semaphore.md"}'),l={name:"java/Semaphore.md"};function p(r,s,t,h,k,d){return e(),a("div",null,s[0]||(s[0]=[n(`<p><img src="https://img.springlearn.cn/learn_c87a079fcea0d7893b03d4d57478bca7.png" alt=""></p><p><strong>ä½œè€…</strong>: è¥¿é­é™¶æ¸Šæ˜ <strong>åšå®¢</strong>: <a href="https://blog.springlearn.cn/" target="_blank" rel="noreferrer">https://blog.springlearn.cn/</a></p><div class="tip custom-block"><p class="custom-block-title">è¥¿é­é™¶æ¸Šæ˜</p><p>è«ç¬‘å°‘å¹´æ±Ÿæ¹–æ¢¦ï¼Œè°ä¸å°‘å¹´æ¢¦æ±Ÿæ¹–</p></div><h2 id="ğŸš€-çŸ¥è¯†å¿«è¯»" tabindex="-1">ğŸš€ çŸ¥è¯†å¿«è¯» <a class="header-anchor" href="#ğŸš€-çŸ¥è¯†å¿«è¯»" aria-label="Permalink to &quot;ğŸš€ çŸ¥è¯†å¿«è¯»&quot;">â€‹</a></h2><p><code>Semaphore</code> ç¿»è¯‘è¿‡æ¥å°±æ˜¯ä¿¡å·é‡, å…¶æ ¹æœ¬åŸç†å°±æ˜¯åŸºäº <code>CAS</code> å…±äº«é”çš„ä¸€ç§å®ç°ã€‚ä¸¾ä¸€ä¸ªä¾‹å­ã€‚ å‡è®¾åœè½¦åœºåªæœ‰ä¸‰ä¸ªè½¦ä½ï¼Œä¸€å¼€å§‹ä¸‰ä¸ªè½¦ä½éƒ½æ˜¯ç©ºçš„ã€‚è¿™æ—¶å¦‚æœåŒæ—¶æ¥äº†äº”è¾†è½¦ï¼Œçœ‹é—¨äººå…è®¸å…¶ä¸­ä¸‰è¾†ä¸å—é˜»ç¢çš„è¿›å…¥ï¼Œç„¶åæ”¾ä¸‹è½¦æ‹¦ï¼Œå‰©ä¸‹çš„è½¦åˆ™å¿…é¡»åœ¨å…¥å£ç­‰å¾…ï¼Œæ­¤åæ¥çš„è½¦ä¹Ÿéƒ½ä¸å¾—ä¸åœ¨å…¥å£å¤„ç­‰å¾…ã€‚è¿™æ—¶ï¼Œæœ‰ä¸€è¾†è½¦ç¦»å¼€åœè½¦åœºï¼Œçœ‹é—¨äººå¾—çŸ¥åï¼Œæ‰“å¼€è½¦æ‹¦ï¼Œæ”¾å…¥ä¸€è¾†ï¼Œå¦‚æœåˆç¦»å¼€ä¸¤è¾†ï¼Œåˆ™åˆå¯ä»¥æ”¾å…¥ä¸¤è¾†ï¼Œå¦‚æ­¤å¾€å¤ã€‚</p><p>é‚£ä¹ˆä¸Šé¢çš„è¿™ä¸ªä¾‹å­å¯ä»¥è¿™æ ·ç†è§£ï¼Œèµ„æºä¸€å…±æœ‰3ä¸ª, å³ä¸‰ä¸ªè½¦ä½ã€‚å¦‚ä½•æ¥æ§åˆ¶è¿™5è¾†æ±½è½¦ï¼Œæ¥åˆç†çš„ä½¿ç”¨è¿™3ä¸ªèµ„æºå‘¢? <code>Semaphore</code> å¯ä»¥è¿™æ ·æ¥å®šä¹‰ã€‚</p><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 1. å®šä¸€ä¸ªä¿¡å·é‡,å£°æ˜æœ‰3ä¸ªèµ„æºã€‚ä½¿ç”¨å…¬å¹³æ¨¡å¼çº¿ç¨‹å°†ä¼šæŒ‰åˆ°è¾¾çš„é¡ºåºï¼ˆFIFOï¼‰æ‰§è¡Œ(ä¹Ÿå°±æ˜¯ç­‰å¾…æ—¶é—´æœ€é•¿çš„å…ˆæ‰§è¡Œ),å¦‚æœæ˜¯éå…¬å¹³ï¼Œåˆ™å¯ä»¥åè¯·æ±‚çš„æœ‰å¯èƒ½æ’åœ¨é˜Ÿåˆ—çš„å¤´éƒ¨ã€‚</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Semaphore semp </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Semaphore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 2. è·å–1ä¸ªè®¸å¯ - æœ€å¤§å…è®¸3ä¸ªè¿›å…¥ï¼Œä¸€ä½†è¶…è¿‡å°±è®©å…¶ç­‰å¾…,é™¤éå·²ç»é‡Šæ”¾</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">semp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 3. é‡Šæ”¾1ä¸ªè®¸å¯ </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">semp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">release</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(); </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 4. è·å–1è®¸å¯,å¤±è´¥å°±è¿”å›,ä¸ç­‰å¾…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">semp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tryAcquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 5. è·å–2è®¸å¯,å¤±è´¥å°±è¿”å›,ä¸ç­‰å¾…</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">semp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">tryAcquire</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 6. ä¸å…è®¸è¢«ä¸­æ–­</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">semp.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">acquireUninterruptibly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">();</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="çŸ¥è¯†ç‚¹1-fair-nofair" tabindex="-1">çŸ¥è¯†ç‚¹1: Fair &amp; NoFair <a class="header-anchor" href="#çŸ¥è¯†ç‚¹1-fair-nofair" aria-label="Permalink to &quot;çŸ¥è¯†ç‚¹1: Fair &amp; NoFair&quot;">â€‹</a></h2><p><code>Semaphore</code> çš„æ¨¡å¼é…ç½®,åªæ˜¯æ„é€ æ¥å®šä¹‰ã€‚</p><ul><li>é»˜è®¤æ„é€ ä¸å…¬å¹³æ¨¡å¼, è°æ¥ç”³è¯·èµ„æº,å°±å…ˆå°è¯•è·å–èµ„æºã€‚æ’é˜Ÿçš„è¦ç­‰åˆ°æ²¡æœ‰èµ„æºè¿›æ¥ç”³è¯·æ‰èƒ½ç»§ç»­ç”³è¯·</li></ul><div class="language-java vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Semaphore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permits) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sync </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NonfairSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(permits);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    public</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Semaphore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">int</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> permits, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">boolean</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fair) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        sync </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fair </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">?</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FairSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(permits) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> new</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> NonfairSync</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(permits);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="https://img.springlearn.cn/blog/learn_1640531082000.png" alt=""></p><h2 id="çŸ¥è¯†ç‚¹2-ç”³è¯·èµ„æº" tabindex="-1">çŸ¥è¯†ç‚¹2: ç”³è¯·èµ„æº <a class="header-anchor" href="#çŸ¥è¯†ç‚¹2-ç”³è¯·èµ„æº" aria-label="Permalink to &quot;çŸ¥è¯†ç‚¹2: ç”³è¯·èµ„æº&quot;">â€‹</a></h2><ul><li>acquire() è·å–1ä¸ªèµ„æº,è·å–ä¸åˆ°å°±ç­‰å¾…,å¦‚æœçº¿ç¨‹ä¸­æ–­,ä¼šç›´æ¥ä¸­æ–­ã€‚</li><li>acquire(2) è·å–2ä¸ªèµ„æº,è·å–ä¸åˆ°å°±ç­‰å¾…,å¦‚æœçº¿ç¨‹ä¸­æ–­,ä¼šç›´æ¥ä¸­æ–­ã€‚</li><li>tryAcquire() è·å–1ä¸ªèµ„æº,è·å–ä¸åˆ°å°±è¿”å› <code>false</code>,å¦‚æœçº¿ç¨‹ä¸­æ–­,ä¼šç›´æ¥ä¸­æ–­ã€‚</li><li>acquireUninterruptibly() è·å–1ä¸ªèµ„æº,è·å–ä¸åˆ°å°±ç­‰å¾…,ä¸ä¼šå…³å¿ƒçº¿ç¨‹ä¸­æ–­ã€‚</li></ul><h2 id="çŸ¥è¯†ç‚¹3-é‡Šæ”¾èµ„æº" tabindex="-1">çŸ¥è¯†ç‚¹3: é‡Šæ”¾èµ„æº <a class="header-anchor" href="#çŸ¥è¯†ç‚¹3-é‡Šæ”¾èµ„æº" aria-label="Permalink to &quot;çŸ¥è¯†ç‚¹3: é‡Šæ”¾èµ„æº&quot;">â€‹</a></h2><ul><li>release() é‡Šæ”¾ä¸€ä¸ªèµ„æº</li><li>release(2) é‡Šæ”¾ä¸¤ä¸ªèµ„æº</li></ul><h2 id="çŸ¥è¯†ç‚¹4-å…¶ä»–api" tabindex="-1">çŸ¥è¯†ç‚¹4: å…¶ä»–API <a class="header-anchor" href="#çŸ¥è¯†ç‚¹4-å…¶ä»–api" aria-label="Permalink to &quot;çŸ¥è¯†ç‚¹4: å…¶ä»–API&quot;">â€‹</a></h2><ul><li>availablePermits() å½“å‰èµ„æºæ•°é‡</li><li>drainPermits() è·å–å½“å‰èµ„æºæ•°é‡ï¼Œå¹¶å°†å‰©ä½™èµ„æºæ¸…é›¶ï¼Œç›´æ¥èµ‹å€¼0</li><li>reducePermits(2) å°†èµ„æºæ•°é‡ï¼Œæ‰£å‡2ä¸ª</li><li>isFair() æ˜¯å¦å…¬å¹³</li><li>hasQueuedThreads() æ˜¯å¦è¿˜æœ‰çº¿ç¨‹ç­‰å¾…</li><li>getQueueLength() è¿˜æœ‰å¤šå°‘çº¿ç¨‹ç­‰å¾…</li><li>getQueuedThreads() è·å–æ‰€æœ‰çš„çº¿ç¨‹é›†åˆ</li></ul>`,18)]))}const o=i(l,[["render",p]]);export{E as __pageData,o as default};
